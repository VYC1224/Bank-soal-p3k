<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kuis P3K untuk kekasihku</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Kuis P3K untuk kekasihku</h1>
    <form id="quizForm">
      <label for="kategori">Pilih Kategori:</label>
      <select id="kategori" name="kategori">
        <option value="teknis">Teknis</option>
        <option value="manajerial">Manajerial</option>
        <option value="sosio_kultural">Sosio Kultural</option>
        <option value="wawancara">Wawancara</option>
      </select>
      <br><br>
      <label for="jumlah">Jumlah Soal:</label>
      <input type="number" id="jumlah" name="jumlah" min="1" max="100" value="5">
      <br><br>
      <button type="submit">Mulai Kuis</button>
      <button type="button" id="lihatSemua">Lihat Semua Soal</button>
    </form>

    <input type="text" id="searchInput" placeholder="Cari pertanyaan..." style="width:100%; margin-top:20px; padding:10px; display:none;">
    <div id="quizContainer"></div>
    <button id="loadMore" style="display:none">Muat Soal Berikutnya</button>
    <div id="result"></div>
  </div>

  <script>
    let soalData = []
    let soalAcak = []
    let soalDitampilkan = 0
    let soalMax = 0
    let jawabanPengguna = {}
    let semuaSoal = []

    function tampilkanSoal() {
      const container = document.getElementById('quizContainer')
      const jumlahLoad = 3
      const sampai = Math.min(soalDitampilkan + jumlahLoad, soalMax)

      for (let i = soalDitampilkan; i < sampai; i++) {
        const soal = soalAcak[i]
        const div = document.createElement('div')
        div.classList.add('soal')
        div.innerHTML = `
          <h4>${i + 1}. ${soal.pertanyaan}</h4>
          ${soal.pilihan.map((p, idx) => `
            <label>
              <input type="radio" name="soal_${i}" value="${idx}">
              ${p}
            </label><br>`).join('')}
        `
        container.appendChild(div)
      }

      soalDitampilkan = sampai
      if (soalDitampilkan >= soalMax) {
        document.getElementById('loadMore').style.display = 'none'
        const selesaiBtn = document.createElement('button')
        selesaiBtn.textContent = 'Selesai'
        selesaiBtn.onclick = periksaJawaban
        container.appendChild(selesaiBtn)
      } else {
        document.getElementById('loadMore').style.display = 'block'
      }
    }

    function periksaJawaban() {
      const result = document.getElementById('result')
      result.innerHTML = '<h3>Hasil:</h3>'

      let benar = 0

      soalAcak.forEach((soal, i) => {
        const radios = document.getElementsByName(`soal_${i}`)
        let jawaban = null
        for (const radio of radios) {
          if (radio.checked) {
            jawaban = parseInt(radio.value)
            break
          }
        }
        jawabanPengguna[i] = jawaban

        if (jawaban === soal.jawaban) {
          benar++
        } else {
          const div = document.createElement('div')
          div.classList.add('salah')
          div.innerHTML = `
            <strong>Soal ${i + 1}:</strong> ${soal.pertanyaan}<br>
            Jawaban Anda: ${soal.pilihan[jawaban] || 'Tidak Dijawab'}<br>
            Jawaban Benar: ${soal.pilihan[soal.jawaban]}
          `
          result.appendChild(div)
        }
      })

      const skor = Math.round((benar / soalMax) * 100)
      const skorText = document.createElement('div')
      skorText.innerHTML = `<h4>Nilaita: ${skor}%</h4>`

      if (skor < 80) {
        skorText.innerHTML += `<p>Yuk belajar lebih giat lagi ya sayangkuu, pasti bisa lebih baik lagi ‚ù§Ô∏è</p>`
      } else if (skor > 90) {
        skorText.innerHTML += `<p>Wah hebat sayangku! bangga dan makin sayang sama sayangkuu ‚ù§Ô∏èü•∞</p>`
      } else {
        skorText.innerHTML += `<p>Nice sayang, tetap semangat ya cintaku ‚ú®</p>`
      }

      result.prepend(skorText)
    }

    document.getElementById('quizForm').addEventListener('submit', function(e) {
      e.preventDefault()
      const kategori = document.getElementById('kategori').value
      soalMax = parseInt(document.getElementById('jumlah').value)
      soalDitampilkan = 0
      jawabanPengguna = {}

      fetch('soal.json')
        .then(res => res.json())
        .then(data => {
          soalData = data[kategori] || []
          soalAcak = soalData.sort(() => 0.5 - Math.random()).slice(0, soalMax)
          document.getElementById('quizContainer').innerHTML = ''
          document.getElementById('result').innerHTML = ''
          document.getElementById('searchInput').style.display = 'none'
          tampilkanSoal()
        })
    })

    document.getElementById('lihatSemua').addEventListener('click', function() {
      const kategori = document.getElementById('kategori').value
      fetch('soal.json')
        .then(res => res.json())
        .then(data => {
          semuaSoal = data[kategori] || []
          const container = document.getElementById('quizContainer')
          container.innerHTML = '<h3>Semua Soal:</h3>'
          document.getElementById('searchInput').style.display = 'block'
          renderSemuaSoal(semuaSoal)
        })
    })

    function renderSemuaSoal(soalList) {
      const container = document.getElementById('quizContainer')
      container.innerHTML = ''
      soalList.forEach((soal, i) => {
        const div = document.createElement('div')
        div.classList.add('soal')
        div.innerHTML = `
          <strong>${i + 1}. ${soal.pertanyaan}</strong><br>
          ${soal.pilihan.map((p, idx) => `${String.fromCharCode(65 + idx)}. ${p}`).join('<br>')}<br>
          <em><strong>Jawaban Benar:</strong> ${soal.pilihan[soal.jawaban]}</em><br><br>`
        container.appendChild(div)
      })
    }

    document.getElementById('searchInput').addEventListener('input', function() {
      const keyword = this.value.toLowerCase()
      const hasilFilter = semuaSoal.filter(soal => soal.pertanyaan.toLowerCase().includes(keyword))
      renderSemuaSoal(hasilFilter)
    })

    document.getElementById('loadMore').addEventListener('click', tampilkanSoal)
  </script>
</body>
</html>
